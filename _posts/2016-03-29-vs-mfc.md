---
layout: post
title: VS2010 MFC
date: 2016-03-29 00:00:00
categories: MFC
excerpt : VS2010 MFC
---

* content
{:toc}

## 环境

- Windows 7
- Visual Studio 2010

## 内容

创建的工程`_ABC_`，有`_ABC_.h/.cpp`和`_ABC_Dlg.h/.cpp`，分别是项目的入口类和主窗体类

### 全局变量

定义在`_ABC_.cpp`里，可以和`C_ABC_App theApp`放一起，如定义`_Test_`类型的变量

```c
#inlude "_Test_.h"
_Test_ myTest;
```

其他对话框类要用到该变量，在`.cpp`里要做如下声明：

```c
#inlude "_Test_.h"
extern _Test_ myTest;
```

### 新建对话框

资源视图，Dialog文件夹，右键插入Dialog，如插入对话框IDD_Add

新建是空白的，有`确定`和`取消`两个按钮

选中窗体，右键，添加类，类名`Add`，初始如下：

```c
//Add.h
#pragma once


// Add 对话框

class Add : public CDialogEx
{
	DECLARE_DYNAMIC(Add)

public:
	Add(CWnd* pParent = NULL);   // 标准构造函数
	virtual ~Add();

// 对话框数据
	enum { IDD = IDD_Add };

protected:
	virtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持

	DECLARE_MESSAGE_MAP()
};
```

```c
//Add.cpp
// Add.cpp : 实现文件
//

#include "stdafx.h"
#include "CtrTest.h"
#include "Add.h"
#include "afxdialogex.h"


// Add 对话框

IMPLEMENT_DYNAMIC(Add, CDialogEx)

Add::Add(CWnd* pParent /*=NULL*/)
	: CDialogEx(Add::IDD, pParent)
{

}

Add::~Add()
{
}

void Add::DoDataExchange(CDataExchange* pDX)
{
	CDialogEx::DoDataExchange(pDX);
}


BEGIN_MESSAGE_MAP(Add, CDialogEx)
END_MESSAGE_MAP()


// Add 消息处理程序
```

### 打开对话框

主窗体增加一个按钮，双击生成按钮函数，增加打开IDD_Add的逻辑：

```c
Add AddDlg;
AddDlg.DoModal();
```

函数的操作前后加如下代码：

```c
UpdateData(TRUE);
//具体的操作
UpdateData(FALSE);
```

### 子窗体关闭回调

```c
Add AddDlg;
if(AddDlg.DoModal() == IDOK
{
	//do something
}
```



